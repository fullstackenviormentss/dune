############################################################################
# Copyright 2007-2015 OceanScan - Marine Systems & Technology, Lda.        #
############################################################################
# This file is part of DUNE: Unified Navigation Environment.               #
#                                                                          #
# Commercial Licence Usage                                                 #
# Licencees holding valid commercial DUNE licences may use this file in    #
# accordance with the commercial licence agreement provided with the       #
# Software or, alternatively, in accordance with the terms contained in a  #
# written agreement between you and Universidade do Porto. For licensing   #
# terms, conditions, and further information contact lsts@fe.up.pt.        #
#                                                                          #
# European Union Public Licence - EUPL v.1.1 Usage                         #
# Alternatively, this file may be used under the terms of the EUPL,        #
# Version 1.1 only (the "Licence"), appearing in the file LICENCE.md       #
# included in the packaging of this file. You may not use this work        #
# except in compliance with the Licence. Unless required by applicable     #
# law or agreed to in writing, software distributed under the Licence is   #
# distributed on an "AS IS" basis, WITHOUT WARRANTIES OR CONDITIONS OF     #
# ANY KIND, either express or implied. See the Licence for the specific    #
# language governing permissions and limitations at                        #
# http://ec.europa.eu/idabc/eupl.html.                                     #
############################################################################
# Author: Jos√© Braga                                                       #
############################################################################
# LAUV NTNU 1 configuration file.                                          #
############################################################################

[Require auv/basic.ini]
[Require hardware/power-consumption.ini]

############################################################################
# General Parameters.                                                      #
############################################################################
[General]
Vehicle                                 = lauv-harald
Absolute Maximum Depth                  = 100
Absolute Minimum Altitude               = 3.0
Battery Packs                           = 8
Power Model -- Conversion - Watt        = 0,  14, 23.5,   48, 88
Power Model -- Conversion - RPM         = 0, 500,  850, 1200, 1485
Speed Conversion -- Actuation           = 0,  36,   44, 59.4
Speed Conversion -- RPM                 = 0, 900, 1100, 1485
Speed Conversion -- MPS                 = 0,   1,  1.3,  1.8
Maximum Absolute Speed                  = 2.5
Hardware List                           = LSTS PCTLv2,
                                          IEI PM-LX2-800W,
                                          Ubiquiti PicoStation M2HP,
                                          U-blox EVK-6H,
                                          Evologics S2CR 18/34,
                                          Keller-33x,
                                          LSTS LC2M,
                                          LSTS BROOM + Motor,
                                          LSTS SCRTv4 + BMS-705MG,
                                          TP-LINK SF1008D,
                                          GSM/UMTS/HDSPA,
                                          Microstrain 3DM-GX4,
                                          Nortek DVL 1MHz (Ethernet),
                                          Aanderaa Optode 4831F,
                                          SeaBird SBE49FastCAT,
                                          WetLabs EcoPuck Triplet

[Transports.Logging]
Flush Interval                          = 0.5

############################################################################
# Navigation.                                                              #
############################################################################

[Navigation.AUV.Navigation]
Distance Between DVL and CG             = 0.38
Distance Between LBL and GPS            = 1.16

[Navigation.General.LBL]
Enabled                                 = Never

# LBL ranger service.
[Navigation.AUV.Ranger]
Enabled                                 = Never

############################################################################
# Control.                                                                 #
############################################################################

[Control.AUV.Allocator]
Maximum Fin Rotation                    = 25.0
Entity Label - Servo Position           = Servo Controller
Pitch Up Brake                          = false
Brake Margin                            = 0.0

[Control.AUV.RemoteOperation]
Disable Analog Thrust                   = false

[Control.AUV.Speed]
Log PID Parcels                         = true

[Control.Path.VectorField]
Bottom Track -- Enabled                 = true
Bottom Track -- Admissible Altitude     = 5.0

[Control.AUV.Attitude]
Roll PID Gains                          = 0.4, 0.0, 0.03
Depth PID Gains                         = 0.4, 0.03, 0.6
Depth Integral Limit                    = 0.035
Maximum Pitch Reference                 = 15.0
Pitch PID Gains                         = 1.5, 0.0, 1.1
Maximum Pitch Actuation                 = 25.0
Heading PID Gains                       = 1.5, 0.0, 0.0
Maximum Heading Rate                    = 30.0
Heading Rate PID Gains                  = 1.2, 0.0, 0.0
Maximum Fin Rotation                    = 25.0
Force Pitch At Surface                  = false
Pitch Angle At Surface                  = 10.0
Log PID Parcels                         = true

[Control.AUV.RemoteOperation]
Pitch Reference                         = 0.0

############################################################################
# Maneuvers.                                                               #
############################################################################

[Maneuver.Multiplexer]
YoYo -- Minimum Altitude Reference      = 10.0
PopUp -- Minimum Satellites             = 6
PopUp -- Report at PopUps               = true

############################################################################
# Monitors.                                                                #
############################################################################

[Monitors.Emergency]
SMS Recipient Number                    = +4798678309
Transmission Interface                  = Iridium

[Monitors.Servos]
Position Fault Detection                = true
Current Fault Detection                 = true
Failure Error Timeout                   = 120.0
Failure Error Count                     = 8

[Monitors.Entities]
Default Monitoring -- Hardware          = Clock,
                                          Leak Sensor,
                                          Motor Controller,
                                          Servo Controller

[Monitors.FuelLevel]
Capacity Decay Factor                   = 5.0

############################################################################
# Hardware.                                                                #
############################################################################

[Sensors.Keller]
Enabled                                 = Hardware
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Frequency                     = 10
Execution Priority                      = 10
Entity Label                            = Depth Sensor
Entity Label - GPS                      = GPS
Serial Port - Device                    = /dev/uart/2
Serial Port - Baud Rate                 = 9600
Serial Port - Local Echo                = 1
Device Address                          = 250
Water Density                           = 1025.0
Timeout - Error                         = 4.0
Timeout - Failure                       = 8.0

[Simulators.DepthSensor]
Enabled                                 = Simulation
Execution Frequency                     = 10
Entity Label                            = Depth Sensor
Standard Deviation                      = 0.05

[UserInterfaces.LEDs]
Enabled                                 = Hardware
Entity Label                            = LEDs
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Priority                      = 10
Parallel Port - Base Address            = 0x378
Start Delay                             = 4.0
Critical Entities                       = Leak Sensor, Leak Sensor - Bottom, Leak Sensor - Antenna
Interface                               = Message
Identifiers                             = Green, Red, White - Back, White - Top
Pattern - Normal                        = 1, 0, 0, 0, 200,
                                          0, 0, 0, 0, 250,
                                          1, 0, 0, 0, 200,
                                          0, 0, 0, 0, 2000
Pattern - Fuel Low                      = 0, 0, 0, 0, 2000,
                                          0, 0, 1, 0, 200,
                                          0, 0, 0, 0, 250,
                                          0, 0, 1, 0, 200
Pattern - Error                         = 0, 0, 0, 0, 250,
                                          1, 0, 0, 0, 250
Pattern - Fatal Error                   = 0, 0, 0, 0, 250,
                                          0, 1, 1, 1, 250
Pattern - Plan Starting                 = 0, 0, 0, 0, 500,
                                          1, 0, 0, 0, 200,
                                          0, 0, 0, 0, 200,
                                          0, 0, 1, 0, 200,
                                          0, 0, 0, 1, 200
Pattern - Plan Executing                = 0, 0, 0, 0, 500,
                                          0, 0, 0, 0, 200,
                                          1, 0, 0, 0, 200,
                                          0, 1, 0, 0, 200,
                                          0, 0, 0, 0, 200
Pattern - Shutdown                      = 1, 1, 1, 1, 100,
                                          0, 0, 0, 0, 50,
                                          1, 1, 1, 1, 100,
                                          0, 0, 0, 0, 500

[Sensors.SCH311X]
Enabled                                 = Hardware
Entity Label                            = Mainboard
Entity Label - Temperature 0            = Mainboard (Core)
Entity Label - Temperature 1            = Mainboard (SuperIO)
Entity Label - Temperature 2            = Mainboard (Board)
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Priority                      = 10
Execution Frequency                     = 1
Path                                    = /sys/class/hwmon/hwmon0/device

[Transports.GSM]
Enabled                                 = Hardware
Entity Label                            = GSM
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Priority                      = 10
Serial Port - Device                    = /dev/ttyACM1
Serial Port - Baud Rate                 = 115200
Reply Timeout                           = 2.0
RSSI Periodicity                        = 10
Read SMS Periodicity                    = 10
SMS Send Timeout                        = 60

[Sensors.GPS]
Enabled                                 = Hardware
Entity Label                            = GPS
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Priority                      = 10
Input Timeout                           = 4.0
Serial Port - Device                    = /dev/ttyACM2
Serial Port - Baud Rate                 = 57600
Power Channel - Names                   = GPS, Communications Board
Sentence Order                          = GPVTG, GPZDA, PUBX
Initialization String 0 - Command       = $PUBX,40,VTG,0,1,0,0,0,0\r\n
Initialization String 1 - Command       = $PUBX,40,ZDA,0,1,0,0,0,0\r\n
Initialization String 2 - Command       = $PUBX,40,00,0,1,0,0,0,0\r\n
Initialization String 3 - Command       = $PUBX,40,GLL,0,0,0,0,0,0\r\n
Initialization String 4 - Command       = $PUBX,40,GSA,0,0,0,0,0,0\r\n
Initialization String 5 - Command       = $PUBX,40,GSV,0,0,0,0,0,0\r\n
Initialization String 6 - Command       = $PUBX,40,RMC,0,0,0,0,0,0\r\n
Initialization String 7 - Command       = $PUBX,40,GGA,0,0,0,0,0,0\r\n
Initialization String 8 - Command       = $PUBX,40,GLL,0,0,0,0,0,0\r\n

# SeaBird CTD.
[Sensors.SBE49FastCAT]
Enabled                        = Hardware
Entity Label                   = CTD
Debug Level                    = None
Serial Port - Device           = /dev/uart/11
Serial Port - Baud Rate        = 38400
Number of Samples to Average   = 8
Zero Conductivity Frequency    = 2780.07
Minimum Conductivity Frequency = 500.0
Pump Delay                     = 30.0
Process In Real-Time           = true
Time to Advance Temperature    = 0.0625
Conductivity Alpha Correction  = 0.03
Conductivity Tau Correction    = 7.0
Activation Time                = 5.0
Deactivation Time              = 0.0
Automatic Activation           = true
Power Channel                  = CTD

# WetLabs EcoPuck Triplet Sensor.
[Sensors.EcoPuck]
Enabled                        = Hardware
Entity Label                   = Water Quality Sensor
Serial Port - Device           = /dev/uart/5
Debug Level                    = None
Input Timeout                  = 5.0
CDOM -- Dark Counts            = 41
CDOM -- Scale Factor           = 0.0896
Chlorophyll -- Dark Counts     = 44
Chlorophyll -- Scale Factor    = 0.0073
Scattering -- Dark Counts      = 44
Scattering -- Scale Factor     = 1.824e-6
Automatic Activation           = true
Activation Time                = 5.0
Deactivation Time              = 0.0
Power Channel                  = Fluorometer

# Aanderaa Optode 4831 Oxygen Sensor.
[Sensors.Optode4831]
[Sensors.Optode4831]
Enabled                        = Hardware
Entity Label                   = Oxygen Sensor
Debug Level                    = None
Serial Port - Device           = /dev/uart/6
Serial Port - Baud Rate        = 115200
Sampling Interval              = 1.0
Measurement String Identifier  = 4831
Entity Label - Temperature     = Depth Sensor
Activation Time                = 5.0
Deactivation Time              = 0.0
Automatic Activation           = true
Power Channel                  = Oxygen Sensor

# Evologics.
[Transports.Evologics]
Enabled                                 = Hardware
Entity Label                            = Acoustic Modem
Execution Priority                      = 10
TCP Port                                = 9200
Source Level                            = 3
Debug Level                             = None
Deactivation Time                       = 0
Activation Time                         = 0
Connection Idle Timeout                 = 0
Connection Retry Count                  = 3
Connection Retry Timeout                = 2000
Pool Size                               = 16384
Instant Message Retry Count             = 0
Highest Address                         = 14
Sound Speed - Default Value             = 1500
Keep Alive - Timeout                    = 5.0
Low Gain                                = false
Source Level - Control                  = true
Source Level - Unknown                  = 3
Source Level - Water                    = 2
Source Level - Underwater               = 1
Address Section                         = Evologics Addresses
IPv4 Address                            = 10.0.10.65

# Nortek DVL
[Sensors.NortekDVL]
Enabled                                 = Hardware
Entity Label                            = DVL
Execution Priority                      = 10
Activation Time                         = 50.0
Deactivation Time                       = 5.0
Debug Level                             = None
Active                                  = true
Active - Scope                          = idle
Active - Visibility                     = developer
Device Orientation                      = 0, -90, 45
Device Position                         = 0.50, 0, 0.20
IO Port - Device                        = tcp://10.0.10.67:9000
Enable Input Trigger                    = false
Serial Port - Baud Rate                 = 115200
Sampling Rate                           = 5.0
Blanking Distance                       = 0.01
Input Trigger Type                      = TTLFALL
Power Channel                           = Private (DVL)
Power Level                             = -2.0
Automatic Activation                    = true
Hardware Debug Mode                     = false
Current Profiler -- Enabled             = false
Current Profiler -- Get At Nth Ping     = 20
Current Profiler -- Number of Cells     = 10
Current Profiler -- Cell Size           = 1.0
Current Profiler -- Blanking Distance   = 0.5

[Simulators.DVL]
Enabled                                 = Simulation
Execution Frequency                     = 5
Entity Label                            = DVL
Standard Deviation - Ground Velocity    = 0.002
Standard Deviation - Water Velocity     = 0.002
Invalid Reading Probability             = 10

# Microstrain 3DM-GX4
[Sensors.MicrostrainMIP]
Enabled                                 = Hardware
Entity Label                            = AHRS
Execution Priority                      = 10
Debug Level                             = None
Activation Time                         = 0
Deactivation Time                       = 0
Serial Port - Device                    = /dev/uart/7
Serial Port - Baud Rate                 = 115200
Sampling Frequency                      = 50
Timeout - Error                         = 4
Timeout - Failure                       = 8
Hard-Iron Calibration                   = 0.0, 0.0, 0.0
Calibration Threshold                   = 0.005
IMU Rotation Matrix                     = 1.0,  0.0,  0.0,
                                          0.0,  1.0,  0.0,
                                          0.0,  0.0,  1.0

[Simulators.IMU/AHRS]
Enabled                                 = Simulation
Entity Label                            = AHRS
Standard Deviation - Euler Angles       = 0.05
Standard Deviation - Angular Velocity   = 0.05
Standard Deviation - Heading Offset     = 0
Gyro Rate Bias                          = 0

# SCRTv4
[Actuators.SCRTv4]
Enabled                                 = Hardware
Entity Label                            = Servo Controller
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Priority                      = 10
Serial Port - Device                    = /dev/uart/9
Servo Directions                        = -1, 1, -1, 1

# BROOM
[Actuators.Broom]
Enabled                           = Hardware
Activation Time                   = 0
Deactivation Time                 = 0
Debug Level                       = None
Execution Priority                = 10
Actuation Watchdog                = 30
Execution Frequency               = 10
Motor Identifier                  = 0
State Sampling Frequency          = 0.5
Motor Pole Pairs                  = 12
Serial Port - Device              = /dev/uart/10
Thrust Control Mode               = rpm
Inverted Rotation                 = true
Accept DesiredSpeed Messages      = false
Entity Label                      = Motor Controller
Motor - Entity Label              = Motor
Bridge - Entity Label             = Motor Controller (Bridge)
MCU - Entity Label                = Motor Controller (MCU)
Timeout - Error                   = 4.0
Timeout - Failure                 = 8.0
Maximum Rotor RPM                 = 2500

# EEPROM Parameters.
Current Raw Offset                = 0
Actuation Watchdog                = 30
Motor Temperature - Maximum       = 85
Motor Temperature - Hysteresis    = 75
Bridge Temperature - Maximum      = 100
Bridge Temperature - Hysteresis   = 50
Control DCYC - Maximum            = 511
Control DCYC - Increment          = 1
Control DCYC - NegL               = 0, 0, 0
Control IADC - Maximum            = 152
Control IADC - Increment          = 2
Control IADC - NegL               = -54, -507, -1094
Control ERPM - Maximum            = 2400
Control ERPM - Increment          = 10
Control ERPM - NegL               = -791, 566, -632

# Iridium SDB.
[Transports.IridiumSBD]
Enabled                      = Hardware
Entity Label                 = Iridium Modem
Active                       = false
Active - Scope               = global
Active - Visibility          = user
Activation Time              = 0
Deactivation Time            = 0
Execution Priority           = 10
Debug Level                  = None
Maximum Transmission Rate    = 0
Serial Port - Device         = /dev/ttyACM0
Serial Port - Baud Rate      = 19200
Mailbox Check - Periodicity  = 1800

# PCTL
[Power.PCTLv2]
Enabled                                 = Hardware
Entity Label                            = Power Supply
Activation Time                         = 0
Deactivation Time                       = 0
Debug Level                             = None
Execution Priority                      = 10
Minimum Operating Voltage               = 22
Wakeup Operating Voltage                = 24
Channel States - Emergency              = 0x01, 0x00, 0x00
Watchdog Timeout                        = 2.0
Serial Port - Device                    = /dev/uart/8
LED - Names                             = Green, Red, White - Back, White - Top
Leak 0 - Entity Label                   = Medium Sensor
Leak 0 - Medium Sensor                  = true
Leak 1 - Entity Label                   = Leak Sensor
Leak 1 - Medium Sensor                  = false
ADC Reference Voltage                   = 1.102
ADC Channel 0 - Message                 = Voltage
ADC Channel 0 - Entity Label            = Batteries
ADC Channel 0 - Conversion              = 31.3030, 0.0
ADC Channel 1 - Message                 = Current
ADC Channel 1 - Entity Label            = Batteries
ADC Channel 1 - Conversion              = 9.0909, 0.0
ADC Channel 2 - Message                 = Voltage
ADC Channel 2 - Entity Label            = Power Supply (+12VDC)
ADC Channel 2 - Conversion              = 15.7058, 0.0
ADC Channel 3 - Message                 = Current
ADC Channel 3 - Entity Label            = Power Supply (+12VDC)
ADC Channel 3 - Conversion              = 4.1322, 0.0
ADC Channel 4 - Message                 = Voltage
ADC Channel 4 - Entity Label            = Power Supply (+5VDC)
ADC Channel 4 - Conversion              = 6.6, 0.0
ADC Channel 5 - Message                 = Current
ADC Channel 5 - Entity Label            = Power Supply (+5VDC)
ADC Channel 5 - Conversion              = 7.5758, 0.0
Power Channel Main - Name               = System
Power Channel 0 - Name                  = Private (ATX)
Power Channel 0 - State                 = 1
Power Channel 1 - Name                  = User Computer
Power Channel 1 - State                 = 0
Power Channel 2 - Name                  = CTD
Power Channel 2 - State                 = 0
Power Channel 3 - Name                  = Fluorometer
Power Channel 3 - State                 = 0
Power Channel 4 - Name                  = Acoustic Modem
Power Channel 4 - State                 = 1
Power Channel 5 - Name                  = N/C (Bout_2)
Power Channel 5 - State                 = 0
Power Channel 6 - Name                  = N/C (Bout_3)
Power Channel 6 - State                 = 0
Power Channel 7 - Name                  = N/C (Bout_4)
Power Channel 7 - State                 = 0
Power Channel 8 - Name                  = Private (CPU)
Power Channel 8 - State                 = 1
Power Channel 9 - Name                  = GPS
Power Channel 9 - State                 = 1
Power Channel 10 - Name                 = Fish Tag
Power Channel 10 - State                = 0
Power Channel 11 - Name                 = N/C (+5V_4)
Power Channel 11 - State                = 0
Power Channel 12 - Name                 = N/C (+5V_5)
Power Channel 12 - State                = 0
Power Channel 13 - Name                 = AHRS
Power Channel 13 - State                = 1
Power Channel 14 - Name                 = Radio
Power Channel 14 - State                = 1
Power Channel 15 - Name                 = Oxygen Sensor
Power Channel 15 - State                = 0
Power Channel 16 - Name                 = N/C (IMU)
Power Channel 16 - State                = 0
Power Channel 17 - Name                 = Private (DVL)
Power Channel 17 - State                = 0


############################################################################
# Transports.                                                              #
############################################################################

[Transports.UAN]
Enabled                                   = Hardware
Entity Label                              = Acoustic Access Controller
Activation Time                           = 0
Deactivation Time                         = 0
Execution Priority                        = 10
Debug Level                               = Spew
Enable Reports                            = true
USBL Modem -- Max Waiting Time            = 10.0
USBL Node -- Absolute Fix                 = false
USBL Node -- Enabled                      = false
USBL Node -- Period                       = 60.0
USBL Node -- Quick, No Range              = false
USBL Modem -- Announce Service            = true

############################################################################
# Autonomy                                                                 #
############################################################################

[Require common/trex.ini]
[Autonomy.TREX]
TREX ID                                 = 65001

[Transports.UDP/TREX]
Static Destinations                     = 10.0.10.66:6969
Announce Service                        = false


############################################################################
# SOI                                                                      #
############################################################################
[Require soi.ini]